import{r as _,m as G,c as d,o as r,a as n,P as t,G as I,J as b,H as o,L as l,ag as H,u as s,M as p,O,a6 as F,aw as J}from"./vendor-qcSz3H5x.js";import{a as A}from"./index-xsH4HHeE.js";import{u as Q,L as W,M as g,N as m,f as j,w as q,r as K,h as X,O as Y,P as Z,Q as v,R as ee,S as te,z as f,G as se,T as oe}from"./elementPlus-Cz6C--fH.js";import{_ as ae}from"./index-CbgkKY63.js";const ne={class:"announcements-page"},le={class:"header"},re={class:"header-content"},ie={class:"nav"},ue={class:"user-section"},ce={class:"user-info"},de={class:"username"},_e={key:1,class:"auth-buttons"},me={class:"announcements-container"},pe={key:0,class:"loading-container"},ge={key:1,class:"announcements-list"},ve=["onClick"],fe={class:"card-header"},he={class:"announcement-title"},ke={class:"publish-date"},ye={class:"card-content"},Ie={class:"announcement-preview"},Se={class:"card-footer"},we={class:"author"},Ce={key:2,class:"empty-state"},be={__name:"Announcements",setup(Ae){const i=J(),h=_([]),k=_(!0),y=_(!1),S=_(""),T=_(""),w=_(""),C=async()=>{try{k.value=!0;const a=await A.get("/api/announcements/published");a.data.success?h.value=a.data.data:f.error("èŽ·å–å…¬å‘Šåˆ—è¡¨å¤±è´¥")}catch(a){console.error("èŽ·å–å…¬å‘Šåˆ—è¡¨å¤±è´¥:",a),f.error("èŽ·å–å…¬å‘Šåˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{k.value=!1}},E=a=>{i.push(`/announcements/${a}`)},x=()=>{C()},z=a=>a?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",D=a=>{if(!a)return"";const e=a.replace(/<[^>]*>/g,"");return e.length>100?e.substring(0,100)+"...":e},L=()=>{(localStorage.getItem("userToken")||localStorage.getItem("adminToken"))&&(y.value=!0,S.value=localStorage.getItem("username")||"",T.value=localStorage.getItem("userRole")||"",N())},N=async()=>{try{const a=localStorage.getItem("userToken")||localStorage.getItem("adminToken");if(!a){console.log("æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·token");return}console.log("æ­£åœ¨èŽ·å–ç”¨æˆ·å¤´åƒï¼Œtoken:",a);const e=await A.get("http://localhost:8080/api/auth/profile",{headers:{Authorization:`Bearer ${a}`}});if(console.log("APIå“åº”:",e.data),e.data&&e.data.avatar_url){const u=e.data.avatar_url.startsWith("http")?e.data.avatar_url:`http://localhost:8080${e.data.avatar_url}`;w.value=u,console.log("è®¾ç½®ç”¨æˆ·å¤´åƒ:",u)}else console.log("APIå“åº”ä¸­æ²¡æœ‰å¤´åƒä¿¡æ¯")}catch(a){console.error("èŽ·å–ç”¨æˆ·å¤´åƒå¤±è´¥:",a)}},P=()=>{i.push("/")},B=()=>{i.push("/login")},R=()=>{i.push("/register")},M=()=>{i.push("/dashboard")},U=()=>{i.push("/publish")},V=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),f.success("åˆ‡æ¢è´¦å·æˆåŠŸ"),i.push("/login")},$=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),f.success("é€€å‡ºæˆåŠŸ"),i.push("/")};return G(()=>{L(),C()}),(a,e)=>{const u=H("router-link");return r(),d("div",ne,[n("header",le,[n("div",re,[n("div",{class:"logo"},[n("h1",{onClick:P},"ðŸ“ ä¸ªäººåšå®¢ç³»ç»Ÿ")]),n("nav",ie,[t(u,{to:"/",class:"nav-link"},{default:o(()=>e[0]||(e[0]=[l("é¦–é¡µ")])),_:1,__:[0]}),t(u,{to:"/articles",class:"nav-link"},{default:o(()=>e[1]||(e[1]=[l("æ–‡ç« ")])),_:1,__:[1]}),t(u,{to:"/announcements",class:"nav-link active"},{default:o(()=>e[2]||(e[2]=[l("å…¬å‘Š")])),_:1,__:[2]}),y.value?(r(),I(u,{key:0,to:"/publish",class:"nav-link"},{default:o(()=>e[3]||(e[3]=[l("å‘å¸ƒæ–‡ç« ")])),_:1,__:[3]})):b("",!0)]),n("div",ue,[y.value?(r(),I(s(Z),{key:0,trigger:"hover",placement:"bottom-end"},{dropdown:o(()=>[t(s(Y),null,{default:o(()=>[t(s(g),{onClick:M},{default:o(()=>[t(s(m),null,{default:o(()=>[t(s(j))]),_:1}),e[4]||(e[4]=l(" ä¸ªäººä¸­å¿ƒ "))]),_:1,__:[4]}),t(s(g),{onClick:U},{default:o(()=>[t(s(m),null,{default:o(()=>[t(s(q))]),_:1}),e[5]||(e[5]=l(" å‘å¸ƒæ–‡ç«  "))]),_:1,__:[5]}),t(s(g),{onClick:V},{default:o(()=>[t(s(m),null,{default:o(()=>[t(s(K))]),_:1}),e[6]||(e[6]=l(" åˆ‡æ¢è´¦å· "))]),_:1,__:[6]}),t(s(g),{divided:"",onClick:$},{default:o(()=>[t(s(m),null,{default:o(()=>[t(s(X))]),_:1}),e[7]||(e[7]=l(" é€€å‡º "))]),_:1,__:[7]})]),_:1})]),default:o(()=>[n("div",ce,[t(s(W),{size:32,src:w.value,icon:s(Q),class:"user-avatar"},null,8,["src","icon"]),n("span",de,p(S.value||"ç”¨æˆ·"),1)])]),_:1})):(r(),d("div",_e,[t(s(v),{onClick:B,size:"small"},{default:o(()=>e[8]||(e[8]=[l("ç™»å½•")])),_:1,__:[8]}),t(s(v),{type:"primary",onClick:R,size:"small"},{default:o(()=>e[9]||(e[9]=[l("æ³¨å†Œ")])),_:1,__:[9]})]))])])]),e[12]||(e[12]=n("div",{class:"page-header"},[n("h1",null,"å…¬å‘Šåˆ—è¡¨"),n("p",{class:"subtitle"},"æŸ¥çœ‹æ‰€æœ‰å·²å‘å¸ƒçš„å…¬å‘Šä¿¡æ¯")],-1)),n("div",me,[k.value?(r(),d("div",pe,[t(s(ee),{rows:5,animated:""})])):h.value.length>0?(r(),d("div",ge,[(r(!0),d(O,null,F(h.value,c=>(r(),d("div",{key:c.id,class:"announcement-card",onClick:Te=>E(c.id)},[n("div",fe,[n("h3",he,[c.isPinned?(r(),I(s(m),{key:0,class:"pin-icon"},{default:o(()=>[t(s(se))]),_:1})):b("",!0),l(" "+p(c.title),1)]),n("span",ke,p(z(c.publishedAt)),1)]),n("div",ye,[n("p",Ie,p(D(c.content)),1)]),n("div",Se,[n("span",we,"å‘å¸ƒè€…ï¼š"+p(c.authorName),1),t(s(v),{type:"primary",size:"small",plain:""},{default:o(()=>[e[10]||(e[10]=l(" æŸ¥çœ‹è¯¦æƒ… ")),t(s(m),null,{default:o(()=>[t(s(oe))]),_:1})]),_:1,__:[10]})])],8,ve))),128))])):(r(),d("div",Ce,[t(s(te),{description:"æš‚æ— å…¬å‘Š"},{default:o(()=>[t(s(v),{type:"primary",onClick:x},{default:o(()=>e[11]||(e[11]=[l("åˆ·æ–°")])),_:1,__:[11]})]),_:1})]))])])}}},Le=ae(be,[["__scopeId","data-v-5bceaaed"]]);export{Le as default};
