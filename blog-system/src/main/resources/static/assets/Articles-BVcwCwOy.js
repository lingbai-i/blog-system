import{r as m,b as _e,p as ve,aA as pe,w as me,az as fe,c as i,o as n,a as l,P as s,H as o,ag as y,J as g,M as d,a4 as ge,L as u,G as V,u as r,O as T,a6 as B}from"./vendor-DAHo6VuW.js";import{a as N}from"./index-xsH4HHeE.js";import{n as he,j as ye,s as G,t as M,f as P,g as U,e as W,b as ke,k as be}from"./elementPlus-Da0LKy-i.js";import{_ as Ce}from"./index-C_Y6TLtC.js";const we={class:"articles-page"},Se={class:"header"},ze={class:"container"},Ve={class:"header-content"},Ae={class:"nav"},qe={class:"main"},xe={class:"container"},Te={class:"search-section"},Be={class:"search-header"},Ne={class:"search-stats-inline"},Ue={class:"search-form"},De={class:"filter-options"},Je={class:"filter-group"},Ee={class:"filter-label"},Le={class:"option-content"},Me={class:"option-content"},Pe={class:"filter-group"},$e={class:"filter-label"},je={class:"option-content"},Fe={class:"option-content"},Ie={class:"filter-group"},Ke={class:"filter-label"},Re={class:"option-content"},He={class:"option-content"},Oe={class:"option-content"},Ge={class:"filter-actions"},We={class:"search-stats"},Xe={key:0},Ye={key:1},Ze={key:2},Qe={key:3},et={key:4},tt={key:0,class:"loading"},at={key:1,class:"articles-list"},st=["onClick"],lt={class:"article-content"},ot={class:"article-text"},nt={class:"article-title"},ut={class:"article-summary"},it={class:"article-meta"},rt={class:"author"},ct={class:"date"},dt={key:0,class:"category"},_t={class:"views"},vt={class:"likes"},pt={class:"comments"},mt={key:0,class:"article-tags"},ft={key:0,class:"article-image"},gt=["src","alt"],ht={key:2,class:"no-articles"},yt={key:3,class:"search-suggestions"},kt={class:"suggestion-tags"},bt={key:4,class:"pagination"},Ct={__name:"Articles",setup(wt){const D=fe(),k=pe(),w=m([]),J=m([]),$=m([]),S=m(0),b=m(1),A=m(10),q=m(!1),f=m("publishTime"),_=m(""),v=m(""),p=m(""),X=m(["Vue.js","Spring Boot","JavaScript","Java","MySQL","前端开发","后端开发","数据库","算法","架构设计"]),E=_e(()=>_.value.trim()!==""||v.value!==""||p.value!=="");ve(()=>{k.query.keyword&&(_.value=k.query.keyword),k.query.category&&(v.value=k.query.category),k.query.tag&&(p.value=k.query.tag),k.query.sort&&(f.value=k.query.sort),Y(),Z(),C()}),me(()=>k.query,a=>{_.value=a.keyword||"",v.value=a.category||"",p.value=a.tag||"",f.value=a.sort||"publishTime",C()});const Y=async()=>{try{const a=await N.get("/api/categories");a.data&&(J.value=a.data)}catch(a){console.error("获取分类失败:",a);try{const e=await N.get("/api/blogs/categories");e.data&&(J.value=e.data.map(h=>typeof h=="string"?{name:h}:h))}catch(e){console.error("获取分类失败（备选接口）:",e),J.value=[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"学习笔记"},{id:4,name:"项目经验"}]}}},Z=async()=>{try{const a=await N.get("/api/tags/active");a.data&&($.value=a.data)}catch(a){console.error("获取标签失败:",a),$.value=[{id:1,name:"Vue.js",isActive:!0},{id:2,name:"Spring Boot",isActive:!0},{id:3,name:"JavaScript",isActive:!0},{id:4,name:"Java",isActive:!0},{id:5,name:"MySQL",isActive:!0},{id:6,name:"前端开发",isActive:!0},{id:7,name:"后端开发",isActive:!0}]}},C=async()=>{q.value=!0;try{const a={page:b.value-1,size:A.value};_.value.trim()&&(a.keyword=_.value.trim()),v.value&&(a.category=v.value),p.value&&(a.tag=p.value),f.value&&(a.sort=f.value),console.log("搜索参数:",a),console.log("当前排序方式:",f.value);const e=await N.get("/api/blogs",{params:a});e.data&&e.data.content?(w.value=e.data.content,S.value=e.data.totalElements,await te()):(w.value=[],S.value=0),Q()}catch(a){console.error("搜索失败:",a),he.error("搜索失败，请稍后重试"),w.value=[],S.value=0}finally{q.value=!1}},Q=()=>{const a={};_.value.trim()&&(a.keyword=_.value.trim()),v.value&&(a.category=v.value),p.value&&(a.tag=p.value),f.value!=="publishTime"&&(a.sort=f.value),D.replace({query:a})},K=()=>{_.value="",v.value="",p.value="",f.value="publishTime",b.value=1,D.replace({query:{}}),C()},ee=a=>{_.value=a,C()},te=async()=>{try{const a=w.value.map(async e=>{try{const h=await N.get(`/api/comments/blog/${e.id}/count`);e.commentCount=h.data.count||0}catch(h){console.error(`获取文章 ${e.id} 评论数量失败:`,h),e.commentCount=0}});await Promise.all(a)}catch(a){console.error("获取评论数量失败:",a)}},x=()=>{b.value=1,C()},ae=()=>{x()},se=a=>{A.value=a,b.value=1,C()},le=a=>{b.value=a,C()},oe=()=>{console.log("排序方式已改变为:",f.value),b.value=1,C()},ne=a=>{console.log("文章列表页点击文章，ID:",a),D.push(`/blog/${a}`)},R=()=>{D.push("/")},ue=a=>a?new Date(a).toLocaleDateString("zh-CN"):"",H=a=>{if(!a.images)return null;try{const e=typeof a.images=="string"?JSON.parse(a.images):a.images;if(Array.isArray(e)&&e.length>0)return e[0]}catch(e){console.error("解析图片数据失败:",e)}return null};return(a,e)=>{const h=y("router-link"),c=y("el-icon"),ie=y("el-input"),z=y("el-option"),j=y("el-select"),L=y("el-button"),re=y("el-skeleton"),O=y("el-tag"),ce=y("el-empty"),de=y("el-pagination");return n(),i("div",we,[l("header",Se,[l("div",ze,[l("div",Ve,[l("h1",{class:"logo",onClick:R},"个人博客"),l("nav",Ae,[s(h,{to:"/",class:"nav-link"},{default:o(()=>e[6]||(e[6]=[u("首页")])),_:1,__:[6]}),s(h,{to:"/articles",class:"nav-link active"},{default:o(()=>e[7]||(e[7]=[u("文章")])),_:1,__:[7]})])])])]),l("main",qe,[l("div",xe,[l("div",Te,[l("div",Be,[e[8]||(e[8]=l("h1",null,"文章浏览",-1)),l("div",Ne,[s(c,null,{default:o(()=>[s(r(M))]),_:1}),l("span",null,d(S.value)+" 篇文章",1)])]),l("div",Ue,[s(ie,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"输入关键字搜索文章...",class:"search-input",size:"large",onKeyup:ge(ae,["enter"]),onInput:x,clearable:""},{prefix:o(()=>[s(c,{class:"search-icon"},{default:o(()=>[s(r(G))]),_:1})]),_:1},8,["modelValue"])]),l("div",De,[l("div",Je,[l("label",Ee,[s(c,null,{default:o(()=>[s(r(P))]),_:1}),e[9]||(e[9]=u(" 分类筛选 "))]),s(j,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),placeholder:"全部分类",clearable:"",onChange:x,class:"filter-select category-select",size:"large"},{default:o(()=>[s(z,{label:"全部分类",value:""},{default:o(()=>[l("span",Le,[s(c,null,{default:o(()=>[s(r(P))]),_:1}),e[10]||(e[10]=u(" 全部分类 "))])]),_:1}),(n(!0),i(T,null,B(J.value,t=>(n(),V(z,{key:t.id||t,label:t.name||t,value:t.name||t},{default:o(()=>[l("span",Me,[s(c,null,{default:o(()=>[s(r(P))]),_:1}),u(" "+d(t.name||t),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",Pe,[l("label",$e,[s(c,null,{default:o(()=>[s(r(U))]),_:1}),e[11]||(e[11]=u(" 标签筛选 "))]),s(j,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),placeholder:"全部标签",clearable:"",onChange:x,class:"filter-select tag-select",size:"large"},{default:o(()=>[s(z,{label:"全部标签",value:""},{default:o(()=>[l("span",je,[s(c,null,{default:o(()=>[s(r(U))]),_:1}),e[12]||(e[12]=u(" 全部标签 "))])]),_:1}),(n(!0),i(T,null,B($.value,t=>(n(),V(z,{key:t.id||t,label:t.name||t,value:t.name||t},{default:o(()=>[l("span",Fe,[s(c,null,{default:o(()=>[s(r(U))]),_:1}),u(" "+d(t.name||t),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",Ie,[l("label",Ke,[s(c,null,{default:o(()=>[s(r(M))]),_:1}),e[13]||(e[13]=u(" 排序方式 "))]),s(j,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),onChange:oe,class:"filter-select sort-select",size:"large"},{default:o(()=>[s(z,{label:"发布时间",value:"publishTime"},{default:o(()=>[l("span",Re,[s(c,null,{default:o(()=>[s(r(W))]),_:1}),e[14]||(e[14]=u(" 发布时间 "))])]),_:1}),s(z,{label:"最多点赞",value:"liked"},{default:o(()=>[l("span",He,[s(c,null,{default:o(()=>[s(r(U))]),_:1}),e[15]||(e[15]=u(" 最多点赞 "))])]),_:1}),s(z,{label:"热度排序",value:"popular"},{default:o(()=>[l("span",Oe,[s(c,null,{default:o(()=>[s(r(M))]),_:1}),e[16]||(e[16]=u(" 热度排序 "))])]),_:1})]),_:1},8,["modelValue"])]),l("div",Ge,[E.value?(n(),V(L,{key:0,onClick:K,class:"clear-btn",size:"large",icon:r(ye)},{default:o(()=>e[17]||(e[17]=[u(" 清空筛选 ")])),_:1,__:[17]},8,["icon"])):g("",!0),s(L,{onClick:x,type:"primary",class:"search-btn",size:"large",icon:r(G),loading:q.value},{default:o(()=>e[18]||(e[18]=[u(" 搜索 ")])),_:1,__:[18]},8,["icon","loading"])])])]),l("div",We,[l("p",null,[_.value?(n(),i("span",Xe,'搜索 "'+d(_.value)+'"',1)):g("",!0),v.value?(n(),i("span",Ye,' 在分类 "'+d(v.value)+'" 中',1)):g("",!0),p.value?(n(),i("span",Ze,' 标签 "'+d(p.value)+'"',1)):g("",!0),!_.value&&!v.value&&!p.value?(n(),i("span",Qe,"共有")):g("",!0),_.value||v.value||p.value?(n(),i("span",et,"找到")):g("",!0),u(" "+d(S.value)+" 篇文章 ",1)])]),q.value?(n(),i("div",tt,[s(re,{rows:3,animated:""})])):w.value.length>0?(n(),i("div",at,[(n(!0),i(T,null,B(w.value,t=>{var F;return n(),i("div",{key:t.id,class:"article-card",onClick:I=>ne(t.id)},[l("div",lt,[l("div",ot,[l("h3",nt,d(t.title),1),l("p",ut,d(t.summary||((F=t.content)==null?void 0:F.substring(0,150))+"..."),1),l("div",it,[l("span",rt,[s(c,null,{default:o(()=>[s(r(ke))]),_:1}),u(" "+d(t.authorName),1)]),l("span",ct,[s(c,null,{default:o(()=>[s(r(W))]),_:1}),u(" "+d(ue(t.publishedAt||t.createdAt)),1)]),t.category?(n(),i("span",dt,[s(c,null,{default:o(()=>[s(r(P))]),_:1}),u(" "+d(t.category),1)])):g("",!0),l("span",_t,[s(c,null,{default:o(()=>[s(r(M))]),_:1}),u(" 热度 "+d(t.viewCount||0),1)]),l("span",vt,[s(c,null,{default:o(()=>[s(r(U))]),_:1}),u(" "+d(t.likeCount||0)+" 点赞 ",1)]),l("span",pt,[s(c,null,{default:o(()=>[s(r(be))]),_:1}),u(" "+d(t.commentCount||0)+" 评论 ",1)])]),t.tags?(n(),i("div",mt,[(n(!0),i(T,null,B(t.tags.split(","),I=>(n(),V(O,{key:I,size:"small",class:"tag"},{default:o(()=>[u(d(I.trim()),1)]),_:2},1024))),128))])):g("",!0)]),H(t)?(n(),i("div",ft,[l("img",{src:H(t),alt:t.title},null,8,gt)])):g("",!0)])],8,st)}),128))])):(n(),i("div",ht,[s(ce,{description:E.value?"没有找到相关文章":"暂无文章"},{default:o(()=>[E.value?(n(),V(L,{key:0,type:"primary",onClick:K},{default:o(()=>e[19]||(e[19]=[u("清空搜索")])),_:1,__:[19]})):(n(),V(L,{key:1,type:"primary",onClick:R},{default:o(()=>e[20]||(e[20]=[u("返回首页")])),_:1,__:[20]}))]),_:1},8,["description"])])),!E.value&&w.value.length===0&&!q.value?(n(),i("div",yt,[e[21]||(e[21]=l("h3",null,"热门标签",-1)),l("div",kt,[(n(!0),i(T,null,B(X.value,t=>(n(),V(O,{key:t,class:"suggestion-tag",onClick:F=>ee(t)},{default:o(()=>[u(d(t),1)]),_:2},1032,["onClick"]))),128))])])):g("",!0),S.value>A.value?(n(),i("div",bt,[s(de,{"current-page":b.value,"onUpdate:currentPage":e[4]||(e[4]=t=>b.value=t),"page-size":A.value,"onUpdate:pageSize":e[5]||(e[5]=t=>A.value=t),"page-sizes":[10,20,50],total:S.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:se,onCurrentChange:le},null,8,["current-page","page-size","total"])])):g("",!0)])])])}}},qt=Ce(Ct,[["__scopeId","data-v-8efc10d4"]]);export{qt as default};
