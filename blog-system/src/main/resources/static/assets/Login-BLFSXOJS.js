import{r as h,X as J,m as O,aw as B,c as k,o as S,a as o,J as F,P as s,H as n,u as g,ag as d,O as $,a6 as q,L as f,a4 as E,M as w,V as R}from"./vendor-qcSz3H5x.js";import{f as T,I as K,J as P,B as X,z as _,o as j}from"./elementPlus-Cz6C--fH.js";import{a as G}from"./index-xsH4HHeE.js";import{_ as Q}from"./index-CbgkKY63.js";const W={class:"login-page"},Y={class:"login-container"},Z={class:"login-card"},ee={class:"login-header"},se={class:"logo-icon"},oe={key:0,class:"account-history"},te={class:"history-title"},ae={class:"history-accounts"},le=["onClick"],re={class:"account-avatar"},ne={class:"account-info"},ie={class:"account-username"},ue={class:"account-type"},me={class:"account-actions"},ce={class:"login-options"},de={class:"login-footer"},ge={class:"footer-links"},_e={__name:"Login",setup(fe){const c=B(),y=h(),p=h(!1),i=h([]),t=J({username:"",password:"",rememberMe:!1}),V=()=>{const a=localStorage.getItem("accountHistory");if(a)try{i.value=JSON.parse(a)}catch(e){console.error("解析账号历史记录失败:",e),i.value=[]}},I=(a,e,l)=>{const r={id:Date.now().toString(),username:a,role:e,token:l,lastLoginTime:new Date().toISOString()};i.value=i.value.filter(u=>!(u.username===a&&u.role===e)),i.value.unshift(r),i.value.length>5&&(i.value=i.value.slice(0,5)),localStorage.setItem("accountHistory",JSON.stringify(i.value))},M=a=>{a.role==="admin"?(localStorage.setItem("adminToken",a.token),localStorage.setItem("userRole","admin")):(localStorage.setItem("userToken",a.token),localStorage.setItem("userRole","user")),localStorage.setItem("username",a.username),_.success(`欢迎回来，${a.username}！`),a.role==="admin"?c.push("/admin"):c.push("/")},C=a=>{i.value=i.value.filter(e=>e.id!==a),localStorage.setItem("accountHistory",JSON.stringify(i.value)),_.success("账号已移除")},H={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},b=async()=>{if(y.value)try{if(!await y.value.validate())return;p.value=!0;try{const e=await G.post("/api/auth/login",{username:t.username,password:t.password});if(e.data.success){const l=e.data.data.token,r=e.data.data.user||e.data.data,u=r.isAdmin||r.role==="ADMIN"?"admin":"user";u==="admin"?(localStorage.setItem("adminToken",l),localStorage.setItem("userRole","admin")):(localStorage.setItem("userToken",l),localStorage.setItem("userRole","user")),localStorage.setItem("username",r.username||t.username),I(r.username||t.username,u,l),t.rememberMe?localStorage.setItem("rememberedUsername",t.username):localStorage.removeItem("rememberedUsername"),_.success("登录成功"),u==="admin"?c.push("/admin"):c.push("/")}else _.error(e.data.message||"登录失败")}catch(e){console.error("登录请求失败:",e);let l=!1,r="user";if(t.username==="admin"&&t.password==="admin123"){r="admin";const u="mock-admin-token-"+Date.now();localStorage.setItem("adminToken",u),localStorage.setItem("userRole","admin"),localStorage.setItem("username","admin"),I("admin","admin",u),l=!0,c.push("/admin")}else if(t.username==="user"&&t.password==="user123"){r="user";const u="mock-user-token-"+Date.now();localStorage.setItem("userToken",u),localStorage.setItem("userRole","user"),localStorage.setItem("username","user"),I("user","user",u),l=!0,c.push("/")}l?(t.rememberMe?localStorage.setItem("rememberedUsername",t.username):localStorage.removeItem("rememberedUsername"),_.success("登录成功")):_.error("用户名或密码错误")}}catch(a){console.error("表单验证失败:",a)}finally{p.value=!1}},U=()=>{c.push("/")},N=()=>{c.push("/register")};return O(()=>{V();const a=localStorage.getItem("rememberedUsername");a&&(t.username=a,t.rememberMe=!0);const e=localStorage.getItem("adminToken"),l=localStorage.getItem("userToken"),r=localStorage.getItem("userRole");e&&r==="admin"?c.push("/admin"):l&&r==="user"&&c.push("/dashboard")}),(a,e)=>{const l=d("el-icon"),r=d("el-button"),u=d("el-divider"),x=d("el-input"),v=d("el-form-item"),z=d("el-checkbox"),A=d("el-form"),D=d("el-link");return S(),k("div",W,[e[11]||(e[11]=o("div",{class:"bg-decoration"},[o("div",{class:"circle circle-1"}),o("div",{class:"circle circle-2"}),o("div",{class:"circle circle-3"})],-1)),o("div",Y,[o("div",Z,[o("div",ee,[o("div",se,[s(l,{size:"48"},{default:n(()=>[s(g(T))]),_:1})]),e[3]||(e[3]=o("h1",{class:"login-title"},"欢迎回来",-1)),e[4]||(e[4]=o("p",{class:"login-subtitle"},"请输入您的账号密码",-1))]),i.value.length>0?(S(),k("div",oe,[o("div",te,[s(l,null,{default:n(()=>[s(g(K))]),_:1}),e[5]||(e[5]=o("span",null,"选择已登录账号",-1))]),o("div",ae,[(S(!0),k($,null,q(i.value,m=>(S(),k("div",{key:m.id,class:"history-account",onClick:L=>M(m)},[o("div",re,[s(l,null,{default:n(()=>[s(g(T))]),_:1})]),o("div",ne,[o("div",ie,w(m.username),1),o("div",ue,w(m.role==="admin"?"管理员":"普通用户"),1)]),o("div",me,[s(r,{type:"danger",size:"small",text:"",onClick:R(L=>C(m.id),["stop"])},{default:n(()=>[s(l,null,{default:n(()=>[s(g(j))]),_:1})]),_:2},1032,["onClick"])])],8,le))),128))]),s(u,null,{default:n(()=>e[6]||(e[6]=[f("或手动输入")])),_:1,__:[6]})])):F("",!0),s(A,{ref_key:"loginFormRef",ref:y,model:t,rules:H,class:"login-form",onSubmit:R(b,["prevent"])},{default:n(()=>[s(v,{prop:"username"},{default:n(()=>[s(x,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=m=>t.username=m),placeholder:"用户名","aria-label":"用户名",size:"large","prefix-icon":g(T),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),s(v,{prop:"password"},{default:n(()=>[s(x,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=m=>t.password=m),type:"password",placeholder:"密码","aria-label":"密码",size:"large","prefix-icon":g(P),"show-password":"",clearable:"",onKeyup:E(b,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),s(v,null,{default:n(()=>[o("div",ce,[s(z,{modelValue:t.rememberMe,"onUpdate:modelValue":e[2]||(e[2]=m=>t.rememberMe=m)},{default:n(()=>e[7]||(e[7]=[f(" 记住我 ")])),_:1,__:[7]},8,["modelValue"])])]),_:1}),s(v,null,{default:n(()=>[s(r,{type:"primary",size:"large",class:"login-button",loading:p.value,onClick:b},{default:n(()=>[f(w(p.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),o("div",de,[o("div",ge,[e[9]||(e[9]=o("span",null,"还没有账号？",-1)),s(D,{type:"primary",onClick:N},{default:n(()=>e[8]||(e[8]=[f("点击注册")])),_:1,__:[8]})]),s(r,{link:"",onClick:U},{default:n(()=>[s(l,null,{default:n(()=>[s(g(X))]),_:1}),e[10]||(e[10]=f(" 返回首页 "))]),_:1,__:[10]})])])])])}}},ye=Q(_e,[["__scopeId","data-v-16bdfe1e"]]);export{ye as default};
