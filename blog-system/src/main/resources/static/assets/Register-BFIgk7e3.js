import{r as v,X as S,c as P,o as T,aA as _,a as c,P as a,H as o,ag as d,u as m,L as w,aw as q}from"./vendor-qcSz3H5x.js";import{f as x,J as b,z as i}from"./elementPlus-Cz6C--fH.js";import{a as V}from"./index-xsH4HHeE.js";import{_ as C}from"./index-CbgkKY63.js";const N={class:"register-page"},U={class:"register-container"},B={class:"register-card"},E={class:"register-footer"},F={__name:"Register",setup(z){const n=q(),p=v(),g=v(!1),s=S({account:"",username:"",password:"",confirmPassword:""}),k={account:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"账号长度在 3 到 20 个字符",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(u,e,r)=>{e!==s.password?r(new Error("两次输入密码不一致")):r()},trigger:"blur"}]},y=async()=>{if(p.value)try{if(!await p.value.validate())return;g.value=!0;try{const e=await V.post("/api/auth/register",{account:s.account,username:s.username,password:s.password});if(e.data.success){const r=await V.post("/api/auth/login",{account:s.account,password:s.password});if(r.data.success){const t=r.data.data.token,f=r.data.data.user||r.data.data;localStorage.setItem("userToken",t),localStorage.setItem("userRole","user"),localStorage.setItem("username",f.username||s.username),i.success("注册成功，欢迎使用！"),n.push("/")}else i.success("注册成功，请登录"),n.push("/login")}else i.error(e.data.message||"注册失败")}catch(e){if(console.error("注册请求失败:",e),s.account&&s.username&&s.password){const r="mock-user-token-"+Date.now();localStorage.setItem("userToken",r),localStorage.setItem("userRole","user"),localStorage.setItem("username",s.username),i.success("注册成功，欢迎使用！"),n.push("/")}else i.error("注册失败，请稍后重试")}}catch(u){console.error("表单验证失败:",u)}finally{g.value=!1}},R=()=>{n.push("/login")};return(u,e)=>{const r=d("el-input"),t=d("el-form-item"),f=d("el-button"),I=d("el-form"),h=d("el-link");return T(),P("div",N,[e[8]||(e[8]=_('<div class="bg-decoration" data-v-d737d45a><div class="circle circle-1" data-v-d737d45a></div><div class="circle circle-2" data-v-d737d45a></div><div class="circle circle-3" data-v-d737d45a></div><div class="circle circle-4" data-v-d737d45a></div></div>',1)),c("div",U,[c("div",B,[e[7]||(e[7]=_('<div class="register-header" data-v-d737d45a><div class="logo-icon" data-v-d737d45a><i class="el-icon-user-solid" style="font-size:2rem;" data-v-d737d45a></i></div><h1 class="register-title" data-v-d737d45a>欢迎加入</h1><p class="register-subtitle" data-v-d737d45a>创建您的专属账户，开启精彩旅程</p></div>',1)),a(I,{ref_key:"registerFormRef",ref:p,model:s,rules:k,"label-width":"80px",class:"register-form"},{default:o(()=>[a(t,{label:"账号",prop:"account"},{default:o(()=>[a(r,{modelValue:s.account,"onUpdate:modelValue":e[0]||(e[0]=l=>s.account=l),placeholder:"请输入账号","prefix-icon":m(x)},null,8,["modelValue","prefix-icon"])]),_:1}),a(t,{label:"用户名",prop:"username"},{default:o(()=>[a(r,{modelValue:s.username,"onUpdate:modelValue":e[1]||(e[1]=l=>s.username=l),placeholder:"请输入用户名","prefix-icon":m(x)},null,8,["modelValue","prefix-icon"])]),_:1}),a(t,{label:"密码",prop:"password"},{default:o(()=>[a(r,{modelValue:s.password,"onUpdate:modelValue":e[2]||(e[2]=l=>s.password=l),type:"password",placeholder:"请输入密码","prefix-icon":m(b),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),a(t,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[a(r,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=l=>s.confirmPassword=l),type:"password",placeholder:"请确认密码","prefix-icon":m(b),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),a(t,null,{default:o(()=>[a(f,{type:"primary",onClick:y,loading:g.value,class:"register-button"},{default:o(()=>e[4]||(e[4]=[w(" 注册 ")])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1},8,["model"]),c("div",E,[e[6]||(e[6]=c("span",null,"已有账户？",-1)),a(h,{type:"primary",onClick:R},{default:o(()=>e[5]||(e[5]=[w("立即登录")])),_:1,__:[5]})])])])])}}},J=C(F,[["__scopeId","data-v-d737d45a"]]);export{J as default};
