import{r as v,b as Q,m as qe,ax as Le,p as Re,aw as Pe,c as d,o as r,a as l,P as a,G as C,J as h,H as o,L as n,ag as f,u as i,M as _,a4 as Be,O as L,a6 as R}from"./vendor-qcSz3H5x.js";import{a as V}from"./index-xsH4HHeE.js";import{z as ee,u as Ne,f as te,w as $e,r as De,h as Je,t as E,s as ae,l as M,m as P,n as oe,o as Ee,p as Me}from"./elementPlus-Cz6C--fH.js";import{_ as Fe}from"./index-CbgkKY63.js";const Ke={class:"articles-page"},We={class:"header"},je={class:"header-content"},He={class:"nav"},Oe={class:"user-section"},Ge={class:"user-info"},Xe={class:"username"},Ye={key:1,class:"auth-buttons"},Ze={class:"main"},Qe={class:"container"},et={class:"search-section"},tt={class:"search-header"},at={class:"search-stats-inline"},ot={class:"search-form"},st={class:"filter-options"},lt={class:"filter-group"},nt={class:"filter-label"},rt={class:"option-content"},ut={class:"option-content"},it={class:"filter-group"},ct={class:"filter-label"},dt={class:"option-content"},_t={class:"option-content"},vt={class:"filter-group"},mt={class:"filter-label"},pt={class:"option-content"},gt={class:"option-content"},ft={class:"option-content"},ht={class:"filter-actions"},yt={class:"search-stats"},kt={key:0},bt={key:1},Ct={key:2},St={key:3},wt={key:4},At={key:0,class:"loading"},It={key:1,class:"articles-list"},Tt=["onClick"],zt={class:"article-content"},Vt={class:"article-text"},Ut={class:"article-title"},xt={class:"article-summary"},qt={class:"article-meta"},Lt={class:"author"},Rt={class:"date"},Pt={key:0,class:"category"},Bt={class:"views"},Nt={class:"likes"},$t={class:"comments"},Dt={key:0,class:"article-tags"},Jt={key:0,class:"article-image"},Et=["src","alt"],Mt={key:2,class:"no-articles"},Ft={key:3,class:"search-suggestions"},Kt={class:"suggestion-tags"},Wt={key:4,class:"pagination"},jt={__name:"Articles",setup(Ht){const k=Pe(),b=Le(),A=v([]),B=v([]),F=v([]),I=v(0),S=v(1),U=v(10),x=v(!1),y=v("publishTime"),m=v(""),p=v(""),g=v(""),K=v(!1),W=v(""),se=v(""),H=v(""),le=v(["Vue.js","Spring Boot","JavaScript","Java","MySQL","å‰ç«¯å¼€å‘","åŽç«¯å¼€å‘","æ•°æ®åº“","ç®—æ³•","æž¶æž„è®¾è®¡"]),N=Q(()=>m.value.trim()!==""||p.value!==""||g.value!=="");Q(()=>W.value||localStorage.getItem("username")||"ç”¨æˆ·");const ne=()=>{localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),location.reload()},re=()=>{k.push("/login")},ue=()=>{k.push("/register")},ie=()=>{k.push("/dashboard")},ce=()=>{k.push("/publish")},O=()=>{k.push("/")},de=()=>{(localStorage.getItem("userToken")||localStorage.getItem("adminToken"))&&(K.value=!0,W.value=localStorage.getItem("username")||"",se.value=localStorage.getItem("userRole")||"",_e())},_e=async()=>{try{const t=localStorage.getItem("userToken")||localStorage.getItem("adminToken");if(!t){console.log("æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·token");return}console.log("æ­£åœ¨èŽ·å–ç”¨æˆ·å¤´åƒï¼Œtoken:",t);const e=await V.get("http://localhost:8080/api/auth/profile",{headers:{Authorization:`Bearer ${t}`}});if(console.log("APIå“åº”:",e.data),e.data&&e.data.avatar_url){const u=e.data.avatar_url.startsWith("http")?e.data.avatar_url:`http://localhost:8080${e.data.avatar_url}`;H.value=u,console.log("è®¾ç½®ç”¨æˆ·å¤´åƒ:",u)}else console.log("APIå“åº”ä¸­æ²¡æœ‰å¤´åƒä¿¡æ¯")}catch(t){console.error("èŽ·å–ç”¨æˆ·å¤´åƒå¤±è´¥:",t)}};qe(()=>{de(),b.query.keyword&&(m.value=b.query.keyword),b.query.category&&(p.value=b.query.category),b.query.tag&&(g.value=b.query.tag),b.query.sort&&(y.value=b.query.sort),ve(),me(),w()}),Re(()=>b.query,t=>{m.value=t.keyword||"",p.value=t.category||"",g.value=t.tag||"",y.value=t.sort||"publishTime",w()});const ve=async()=>{try{const t=await V.get("/api/categories");t.data&&(B.value=t.data)}catch(t){console.error("èŽ·å–åˆ†ç±»å¤±è´¥:",t);try{const e=await V.get("/api/blogs/categories");e.data&&(B.value=e.data.map(u=>typeof u=="string"?{name:u}:u))}catch(e){console.error("èŽ·å–åˆ†ç±»å¤±è´¥ï¼ˆå¤‡é€‰æŽ¥å£ï¼‰:",e),B.value=[{id:1,name:"æŠ€æœ¯åˆ†äº«"},{id:2,name:"ç”Ÿæ´»éšç¬”"},{id:3,name:"å­¦ä¹ ç¬”è®°"},{id:4,name:"é¡¹ç›®ç»éªŒ"}]}}},me=async()=>{try{const t=await V.get("/api/tags/active");t.data&&(F.value=t.data)}catch(t){console.error("èŽ·å–æ ‡ç­¾å¤±è´¥:",t),F.value=[{id:1,name:"Vue.js",isActive:!0},{id:2,name:"Spring Boot",isActive:!0},{id:3,name:"JavaScript",isActive:!0},{id:4,name:"Java",isActive:!0},{id:5,name:"MySQL",isActive:!0},{id:6,name:"å‰ç«¯å¼€å‘",isActive:!0},{id:7,name:"åŽç«¯å¼€å‘",isActive:!0}]}},w=async()=>{x.value=!0;try{const t={page:S.value-1,size:U.value};m.value.trim()&&(t.keyword=m.value.trim()),p.value&&(t.category=p.value),g.value&&(t.tag=g.value),y.value&&(t.sort=y.value),console.log("æœç´¢å‚æ•°:",t),console.log("å½“å‰æŽ’åºæ–¹å¼:",y.value);const e=await V.get("/api/blogs",{params:t});e.data&&e.data.content?(A.value=e.data.content,I.value=e.data.totalElements,await fe()):(A.value=[],I.value=0),pe()}catch(t){console.error("æœç´¢å¤±è´¥:",t),ee.error("æœç´¢å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"),A.value=[],I.value=0}finally{x.value=!1}},pe=()=>{const t={};m.value.trim()&&(t.keyword=m.value.trim()),p.value&&(t.category=p.value),g.value&&(t.tag=g.value),y.value!=="publishTime"&&(t.sort=y.value),k.replace({query:t})},G=()=>{m.value="",p.value="",g.value="",y.value="publishTime",S.value=1,k.replace({query:{}}),w()},ge=t=>{m.value=t,w()},fe=async()=>{try{const t=A.value.map(async e=>{try{const u=await V.get(`/api/comments/blog/${e.id}/count`);e.commentCount=u.data.count||0}catch(u){console.error(`èŽ·å–æ–‡ç«  ${e.id} è¯„è®ºæ•°é‡å¤±è´¥:`,u),e.commentCount=0}});await Promise.all(t)}catch(t){console.error("èŽ·å–è¯„è®ºæ•°é‡å¤±è´¥:",t)}},q=()=>{S.value=1,w()},he=()=>{q()},ye=t=>{U.value=t,S.value=1,w()},ke=t=>{S.value=t,w()},be=()=>{console.log("æŽ’åºæ–¹å¼å·²æ”¹å˜ä¸º:",y.value),S.value=1,w()},Ce=t=>{console.log("æ–‡ç« åˆ—è¡¨é¡µç‚¹å‡»æ–‡ç« ï¼ŒID:",t),k.push(`/blog/${t}`)},Se=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),ee.success("åˆ‡æ¢è´¦å·æˆåŠŸ"),k.push("/login")},we=t=>t?new Date(t).toLocaleDateString("zh-CN"):"",X=t=>{if(console.log("èŽ·å–æ–‡ç« å›¾ç‰‡:",t.id,t.images),console.log("æ–‡ç« å®Œæ•´æ•°æ®:",t),!t.images)return console.log("æ–‡ç« æ— imageså­—æ®µ:",t.id),null;try{const e=typeof t.images=="string"?JSON.parse(t.images):t.images;if(console.log("è§£æžåŽçš„images:",e),console.log("imagesç±»åž‹:",typeof e,"isArray:",Array.isArray(e)),Array.isArray(e)&&e.length>0){const u=e[0];console.log("åŽŸå§‹å›¾ç‰‡URL:",u);const $=u.startsWith("http")?u:`http://localhost:8080${u}`;return console.log("è¿”å›žå›¾ç‰‡URL:",$),$}else console.log("imagesä¸æ˜¯æ•°ç»„æˆ–ä¸ºç©º:",e)}catch(e){console.error("è§£æžå›¾ç‰‡æ•°æ®å¤±è´¥:",e,t.images)}return console.log("æœªæ‰¾åˆ°æœ‰æ•ˆå›¾ç‰‡ï¼Œè¿”å›žnull"),null},Y=t=>{if(!t)return[];try{if(typeof t=="string"){if(t.startsWith("[")&&t.endsWith("]")){const e=JSON.parse(t);return Array.isArray(e)?e.filter(u=>u&&u.trim()):[]}return t.split(",").map(e=>e.trim()).filter(e=>e)}if(Array.isArray(t))return t.filter(e=>e&&e.trim())}catch(e){console.error("è§£æžæ ‡ç­¾æ•°æ®å¤±è´¥:",e)}return[]},Ae=t=>{if(t.summary&&t.summary.trim())return t.summary;if(t.content){const e=document.createElement("div");e.innerHTML=t.content;const u=e.textContent||e.innerText||"";return u.substring(0,150)+(u.length>150?"...":"")}return"æš‚æ— æ‘˜è¦"};return(t,e)=>{const u=f("router-link"),$=f("el-avatar"),c=f("el-icon"),D=f("el-dropdown-item"),Ie=f("el-dropdown-menu"),Te=f("el-dropdown"),z=f("el-button"),ze=f("el-input"),T=f("el-option"),j=f("el-select"),Ve=f("el-skeleton"),Z=f("el-tag"),Ue=f("el-empty"),xe=f("el-pagination");return r(),d("div",Ke,[l("header",We,[l("div",je,[l("div",{class:"logo"},[l("h1",{onClick:O},"ðŸ“ ä¸ªäººåšå®¢ç³»ç»Ÿ")]),l("nav",He,[a(u,{to:"/",class:"nav-link"},{default:o(()=>e[6]||(e[6]=[n("é¦–é¡µ")])),_:1,__:[6]}),a(u,{to:"/articles",class:"nav-link active"},{default:o(()=>e[7]||(e[7]=[n("æ–‡ç« ")])),_:1,__:[7]}),a(u,{to:"/announcements",class:"nav-link"},{default:o(()=>e[8]||(e[8]=[n("å…¬å‘Š")])),_:1,__:[8]}),K.value?(r(),C(u,{key:0,to:"/publish",class:"nav-link"},{default:o(()=>e[9]||(e[9]=[n("å‘å¸ƒæ–‡ç« ")])),_:1,__:[9]})):h("",!0)]),l("div",Oe,[K.value?(r(),C(Te,{key:0,trigger:"hover",placement:"bottom-end"},{dropdown:o(()=>[a(Ie,null,{default:o(()=>[a(D,{onClick:ie},{default:o(()=>[a(c,null,{default:o(()=>[a(i(te))]),_:1}),e[10]||(e[10]=n(" ä¸ªäººä¸­å¿ƒ "))]),_:1,__:[10]}),a(D,{onClick:ce},{default:o(()=>[a(c,null,{default:o(()=>[a(i($e))]),_:1}),e[11]||(e[11]=n(" å‘å¸ƒæ–‡ç«  "))]),_:1,__:[11]}),a(D,{onClick:Se},{default:o(()=>[a(c,null,{default:o(()=>[a(i(De))]),_:1}),e[12]||(e[12]=n(" åˆ‡æ¢è´¦å· "))]),_:1,__:[12]}),a(D,{divided:"",onClick:ne},{default:o(()=>[a(c,null,{default:o(()=>[a(i(Je))]),_:1}),e[13]||(e[13]=n(" é€€å‡º "))]),_:1,__:[13]})]),_:1})]),default:o(()=>[l("div",Ge,[a($,{size:32,src:H.value,icon:i(Ne),class:"user-avatar"},null,8,["src","icon"]),l("span",Xe,_(W.value||"ç”¨æˆ·"),1)])]),_:1})):(r(),d("div",Ye,[a(z,{onClick:re,size:"small"},{default:o(()=>e[14]||(e[14]=[n("ç™»å½•")])),_:1,__:[14]}),a(z,{type:"primary",onClick:ue,size:"small"},{default:o(()=>e[15]||(e[15]=[n("æ³¨å†Œ")])),_:1,__:[15]})]))])])]),l("main",Ze,[l("div",Qe,[l("div",et,[l("div",tt,[e[16]||(e[16]=l("h1",null,"æ–‡ç« æµè§ˆ",-1)),l("div",at,[a(c,null,{default:o(()=>[a(i(E))]),_:1}),l("span",null,_(I.value)+" ç¯‡æ–‡ç« ",1)])]),l("div",ot,[a(ze,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:"è¾“å…¥å…³é”®å­—æœç´¢æ–‡ç« ...","aria-label":"æœç´¢æ–‡ç« ",class:"search-input",size:"large",onKeyup:Be(he,["enter"]),onInput:q,clearable:""},{prefix:o(()=>[a(c,{class:"search-icon"},{default:o(()=>[a(i(ae))]),_:1})]),_:1},8,["modelValue"])]),l("div",st,[l("div",lt,[l("label",nt,[a(c,null,{default:o(()=>[a(i(M))]),_:1}),e[17]||(e[17]=n(" åˆ†ç±»ç­›é€‰ "))]),a(j,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),placeholder:"å…¨éƒ¨åˆ†ç±»",clearable:"",onChange:q,class:"filter-select category-select",size:"large"},{default:o(()=>[a(T,{label:"å…¨éƒ¨åˆ†ç±»",value:""},{default:o(()=>[l("span",rt,[a(c,null,{default:o(()=>[a(i(M))]),_:1}),e[18]||(e[18]=n(" å…¨éƒ¨åˆ†ç±» "))])]),_:1}),(r(!0),d(L,null,R(B.value,s=>(r(),C(T,{key:s.id||s,label:s.name||s,value:s.name||s},{default:o(()=>[l("span",ut,[a(c,null,{default:o(()=>[a(i(M))]),_:1}),n(" "+_(s.name||s),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",it,[l("label",ct,[a(c,null,{default:o(()=>[a(i(P))]),_:1}),e[19]||(e[19]=n(" æ ‡ç­¾ç­›é€‰ "))]),a(j,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),placeholder:"å…¨éƒ¨æ ‡ç­¾",clearable:"",onChange:q,class:"filter-select tag-select",size:"large"},{default:o(()=>[a(T,{label:"å…¨éƒ¨æ ‡ç­¾",value:""},{default:o(()=>[l("span",dt,[a(c,null,{default:o(()=>[a(i(P))]),_:1}),e[20]||(e[20]=n(" å…¨éƒ¨æ ‡ç­¾ "))])]),_:1}),(r(!0),d(L,null,R(F.value,s=>(r(),C(T,{key:s.id||s,label:s.name||s,value:s.name||s},{default:o(()=>[l("span",_t,[a(c,null,{default:o(()=>[a(i(P))]),_:1}),n(" "+_(s.name||s),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",vt,[l("label",mt,[a(c,null,{default:o(()=>[a(i(E))]),_:1}),e[21]||(e[21]=n(" æŽ’åºæ–¹å¼ "))]),a(j,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),onChange:be,class:"filter-select sort-select",size:"large"},{default:o(()=>[a(T,{label:"å‘å¸ƒæ—¶é—´",value:"publishTime"},{default:o(()=>[l("span",pt,[a(c,null,{default:o(()=>[a(i(oe))]),_:1}),e[22]||(e[22]=n(" å‘å¸ƒæ—¶é—´ "))])]),_:1}),a(T,{label:"æœ€å¤šç‚¹èµž",value:"liked"},{default:o(()=>[l("span",gt,[a(c,null,{default:o(()=>[a(i(P))]),_:1}),e[23]||(e[23]=n(" æœ€å¤šç‚¹èµž "))])]),_:1}),a(T,{label:"çƒ­åº¦æŽ’åº",value:"popular"},{default:o(()=>[l("span",ft,[a(c,null,{default:o(()=>[a(i(E))]),_:1}),e[24]||(e[24]=n(" çƒ­åº¦æŽ’åº "))])]),_:1})]),_:1},8,["modelValue"])]),l("div",ht,[N.value?(r(),C(z,{key:0,onClick:G,class:"clear-btn",size:"large",icon:i(Ee)},{default:o(()=>e[25]||(e[25]=[n(" æ¸…ç©ºç­›é€‰ ")])),_:1,__:[25]},8,["icon"])):h("",!0),a(z,{onClick:q,type:"primary",class:"search-btn",size:"large",icon:i(ae),loading:x.value},{default:o(()=>e[26]||(e[26]=[n(" æœç´¢ ")])),_:1,__:[26]},8,["icon","loading"])])])]),l("div",yt,[l("p",null,[m.value?(r(),d("span",kt,'æœç´¢ "'+_(m.value)+'"',1)):h("",!0),p.value?(r(),d("span",bt,' åœ¨åˆ†ç±» "'+_(p.value)+'" ä¸­',1)):h("",!0),g.value?(r(),d("span",Ct,' æ ‡ç­¾ "'+_(g.value)+'"',1)):h("",!0),!m.value&&!p.value&&!g.value?(r(),d("span",St,"å…±æœ‰")):h("",!0),m.value||p.value||g.value?(r(),d("span",wt,"æ‰¾åˆ°")):h("",!0),n(" "+_(I.value)+" ç¯‡æ–‡ç«  ",1)])]),x.value?(r(),d("div",At,[a(Ve,{rows:3,animated:""})])):A.value.length>0?(r(),d("div",It,[(r(!0),d(L,null,R(A.value,s=>(r(),d("div",{key:s.id,class:"article-card",onClick:J=>Ce(s.id)},[l("div",zt,[l("div",Vt,[l("h3",Ut,_(s.title),1),l("p",xt,_(Ae(s)),1),l("div",qt,[l("span",Lt,[a(c,null,{default:o(()=>[a(i(te))]),_:1}),n(" "+_(s.authorName),1)]),l("span",Rt,[a(c,null,{default:o(()=>[a(i(oe))]),_:1}),n(" "+_(we(s.publishedAt||s.createdAt)),1)]),s.category?(r(),d("span",Pt,[a(c,null,{default:o(()=>[a(i(M))]),_:1}),n(" "+_(s.category),1)])):h("",!0),l("span",Bt,[a(c,null,{default:o(()=>[a(i(E))]),_:1}),n(" çƒ­åº¦ "+_(s.viewCount||0),1)]),l("span",Nt,[a(c,null,{default:o(()=>[a(i(P))]),_:1}),n(" "+_(s.likeCount||0)+" ç‚¹èµž ",1)]),l("span",$t,[a(c,null,{default:o(()=>[a(i(Me))]),_:1}),n(" "+_(s.commentCount||0)+" è¯„è®º ",1)])]),s.tags&&Y(s.tags).length>0?(r(),d("div",Dt,[(r(!0),d(L,null,R(Y(s.tags),J=>(r(),C(Z,{key:J,size:"small",class:"tag"},{default:o(()=>[n(_(J.trim()),1)]),_:2},1024))),128))])):h("",!0)]),X(s)?(r(),d("div",Jt,[l("img",{src:X(s),alt:s.title},null,8,Et)])):h("",!0)])],8,Tt))),128))])):(r(),d("div",Mt,[a(Ue,{description:N.value?"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« ":"æš‚æ— æ–‡ç« "},{default:o(()=>[N.value?(r(),C(z,{key:0,type:"primary",onClick:G},{default:o(()=>e[27]||(e[27]=[n("æ¸…ç©ºæœç´¢")])),_:1,__:[27]})):(r(),C(z,{key:1,type:"primary",onClick:O},{default:o(()=>e[28]||(e[28]=[n("è¿”å›žé¦–é¡µ")])),_:1,__:[28]}))]),_:1},8,["description"])])),!N.value&&A.value.length===0&&!x.value?(r(),d("div",Ft,[e[29]||(e[29]=l("h3",null,"çƒ­é—¨æ ‡ç­¾",-1)),l("div",Kt,[(r(!0),d(L,null,R(le.value,s=>(r(),C(Z,{key:s,class:"suggestion-tag",onClick:J=>ge(s)},{default:o(()=>[n(_(s),1)]),_:2},1032,["onClick"]))),128))])])):h("",!0),I.value>U.value?(r(),d("div",Wt,[a(xe,{"current-page":S.value,"onUpdate:currentPage":e[4]||(e[4]=s=>S.value=s),"page-size":U.value,"onUpdate:pageSize":e[5]||(e[5]=s=>U.value=s),"page-sizes":[10,20,50],total:I.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ye,onCurrentChange:ke},null,8,["current-page","page-size","total"])])):h("",!0)])])])}}},Zt=Fe(jt,[["__scopeId","data-v-7e3f38c6"]]);export{Zt as default};
