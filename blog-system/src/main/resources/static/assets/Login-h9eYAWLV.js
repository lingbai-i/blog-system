import{r as S,X as h,p as z,az as C,c as L,o as B,a,P as s,H as t,ag as n,V as D,u as _,L as c,a4 as F,M as N}from"./vendor-DAHo6VuW.js";import{b as y,x as q,p as E,n as f}from"./elementPlus-Da0LKy-i.js";import{a as H}from"./index-xsH4HHeE.js";import{_ as K}from"./index-C_Y6TLtC.js";const P={class:"login-page"},X={class:"login-container"},j={class:"login-card"},A={class:"login-header"},G={class:"logo-icon"},J={class:"login-type"},O={class:"login-options"},Q={class:"login-footer"},W={class:"footer-links"},Y={__name:"Login",setup(Z){const i=C(),v=S(),p=S(!1),m=S("user"),o=h({username:"",password:"",rememberMe:!1}),V={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},b=async()=>{if(v.value)try{if(!await v.value.validate())return;p.value=!0;try{const e=m.value==="admin"?"/api/admin/login":"/api/auth/login",l=await H.post(e,{username:o.username,password:o.password});if(l.data.success){const r=l.data.data.token,k=l.data.data.user||l.data.data;m.value==="admin"?(localStorage.setItem("adminToken",r),localStorage.setItem("userRole","admin")):(localStorage.setItem("userToken",r),localStorage.setItem("userRole","user")),localStorage.setItem("username",k.username||o.username),o.rememberMe?localStorage.setItem("rememberedUsername",o.username):localStorage.removeItem("rememberedUsername"),f.success("登录成功"),m.value==="admin"?i.push("/admin"):i.push("/")}else f.error(l.data.message||"登录失败")}catch(e){console.error("登录请求失败:",e);let l=!1;if(m.value==="admin"&&o.username==="admin"&&o.password==="admin123"){const r="mock-admin-token-"+Date.now();localStorage.setItem("adminToken",r),localStorage.setItem("userRole","admin"),localStorage.setItem("username","admin"),l=!0,i.push("/admin")}else if(m.value==="user"&&o.username==="user"&&o.password==="user123"){const r="mock-user-token-"+Date.now();localStorage.setItem("userToken",r),localStorage.setItem("userRole","user"),localStorage.setItem("username","user"),l=!0,i.push("/")}l?(o.rememberMe?localStorage.setItem("rememberedUsername",o.username):localStorage.removeItem("rememberedUsername"),f.success("登录成功")):f.error("用户名或密码错误")}}catch(d){console.error("表单验证失败:",d)}finally{p.value=!1}},x=()=>{i.push("/")},T=()=>{i.push("/register")};return z(()=>{const d=localStorage.getItem("rememberedUsername");d&&(o.username=d,o.rememberMe=!0);const e=localStorage.getItem("adminToken"),l=localStorage.getItem("userToken"),r=localStorage.getItem("userRole");e&&r==="admin"?i.push("/admin"):l&&r==="user"&&i.push("/dashboard")}),(d,e)=>{const l=n("el-icon"),r=n("el-radio-button"),k=n("el-radio-group"),I=n("el-input"),g=n("el-form-item"),R=n("el-checkbox"),w=n("el-button"),M=n("el-form"),U=n("el-link");return B(),L("div",P,[e[12]||(e[12]=a("div",{class:"bg-decoration"},[a("div",{class:"circle circle-1"}),a("div",{class:"circle circle-2"}),a("div",{class:"circle circle-3"})],-1)),a("div",X,[a("div",j,[a("div",A,[a("div",G,[s(l,{size:"48"},{default:t(()=>[s(_(y))]),_:1})]),e[4]||(e[4]=a("h1",{class:"login-title"},"欢迎回来",-1)),e[5]||(e[5]=a("p",{class:"login-subtitle"},"请选择登录类型并输入您的账号密码",-1))]),a("div",J,[s(k,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=u=>m.value=u),class:"login-type-group"},{default:t(()=>[s(r,{value:"user"},{default:t(()=>e[6]||(e[6]=[c("普通用户")])),_:1,__:[6]}),s(r,{value:"admin"},{default:t(()=>e[7]||(e[7]=[c("管理员")])),_:1,__:[7]})]),_:1},8,["modelValue"])]),s(M,{ref_key:"loginFormRef",ref:v,model:o,rules:V,class:"login-form",onSubmit:D(b,["prevent"])},{default:t(()=>[s(g,{prop:"username"},{default:t(()=>[s(I,{modelValue:o.username,"onUpdate:modelValue":e[1]||(e[1]=u=>o.username=u),placeholder:"用户名",size:"large","prefix-icon":_(y),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),s(g,{prop:"password"},{default:t(()=>[s(I,{modelValue:o.password,"onUpdate:modelValue":e[2]||(e[2]=u=>o.password=u),type:"password",placeholder:"密码",size:"large","prefix-icon":_(q),"show-password":"",clearable:"",onKeyup:F(b,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),s(g,null,{default:t(()=>[a("div",O,[s(R,{modelValue:o.rememberMe,"onUpdate:modelValue":e[3]||(e[3]=u=>o.rememberMe=u)},{default:t(()=>e[8]||(e[8]=[c(" 记住我 ")])),_:1,__:[8]},8,["modelValue"])])]),_:1}),s(g,null,{default:t(()=>[s(w,{type:"primary",size:"large",class:"login-button",loading:p.value,onClick:b},{default:t(()=>[c(N(p.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),a("div",Q,[a("div",W,[e[10]||(e[10]=a("span",null,"还没有账号？",-1)),s(U,{type:"primary",onClick:T},{default:t(()=>e[9]||(e[9]=[c("点击注册")])),_:1,__:[9]})]),s(w,{link:"",onClick:x},{default:t(()=>[s(l,null,{default:t(()=>[s(_(E))]),_:1}),e[11]||(e[11]=c(" 返回首页 "))]),_:1,__:[11]})])])])])}}},ae=K(Y,[["__scopeId","data-v-7089bba2"]]);export{ae as default};
