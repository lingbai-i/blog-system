import{r,p as Ue,c as u,o as i,a as t,P as a,a4 as ie,ag as _,H as o,u as n,G as k,J as V,M as m,O as N,a6 as P,ay as Re,az as xe,L as d}from"./vendor-DAHo6VuW.js";import{s as E,u as ee,a as te,b as ae,c as ce,h as $e,d as De,e as re,t as de,f as ue,g as se,v as Le,j as Ne}from"./elementPlus-Da0LKy-i.js";import{a as b}from"./index-xsH4HHeE.js";import{_ as Pe}from"./index-C_Y6TLtC.js";const Ee={class:"home"},Je={class:"header"},Ke={class:"header-content"},Me={class:"search-container"},je={class:"search-wrapper"},He={class:"user-section"},We={class:"user-info"},Qe={class:"username"},qe={key:1,class:"auth-buttons"},Fe={class:"nav",style:{display:"none"}},Ge={class:"nav-right"},Oe={class:"auth-buttons"},Xe={class:"user-info"},Ye={class:"username"},Ze={class:"main"},et={class:"layout-container"},tt={class:"sidebar"},at={class:"sidebar-content"},st={class:"sidebar-section"},lt={class:"sidebar-menu"},ot={class:"menu-item active"},nt={class:"main-content"},it={class:"hero-banner"},ct={class:"hero-content"},rt={key:0,class:"hero-actions"},dt={key:0,class:"stats-section"},ut={class:"stats-grid"},vt={class:"stat-card"},mt={class:"stat-number"},_t={class:"stat-card"},pt={class:"stat-number"},ft={class:"stat-card"},ht={class:"stat-number"},gt={class:"blog-section"},yt={class:"section-header"},kt={key:0,class:"loading"},bt={key:1,class:"empty"},Ct={key:2,class:"blog-grid"},wt=["onClick"],St={class:"blog-card-content"},Vt={class:"blog-title"},At={class:"blog-summary"},Tt={class:"blog-meta"},It={class:"blog-author"},zt={class:"blog-date"},Bt={class:"blog-views"},Ut={key:3,class:"pagination"},Rt={class:"right-sidebar"},xt={class:"sidebar-content"},$t={class:"sidebar-section"},Dt={class:"hot-articles"},Lt=["onClick"],Nt={class:"hot-rank"},Pt={class:"hot-article-content"},Et={class:"hot-article-title"},Jt={class:"hot-article-meta"},Kt={class:"hot-views"},Mt={class:"search-dialog-content"},jt={class:"search-form"},Ht={class:"filter-section"},Wt={class:"filter-group"},Qt={class:"filter-label"},qt={class:"option-content"},Ft={class:"filter-group"},Gt={class:"filter-label"},Ot={class:"option-content"},Xt={class:"filter-group"},Yt={class:"filter-label"},Zt={class:"option-content"},ea={class:"option-content"},ta={class:"option-content"},aa={key:0,class:"search-suggestions"},sa={class:"suggestion-tags"},la={class:"dialog-footer"},oa={__name:"Home",setup(na){const w=xe(),p=r([]),H=r(!1),f=r(""),T=r(1),I=r(10),z=r(0),C=r(!1),B=r(""),S=r(""),J=r(""),W=r(!1),Q=r(!1),h=r({totalBlogs:0,totalComments:0,totalUsers:0}),U=r(!1),A=r(""),R=r(""),x=r("publishTime"),$=r([]),q=r([]),ve=r(["Vue.js","Spring Boot","JavaScript","Java","MySQL","前端开发","后端开发","数据库","算法","架构设计"]),F=async()=>{H.value=!0;try{const s=await b.get("/api/blogs",{params:{page:T.value-1,size:I.value,keyword:f.value}});s.data&&s.data.content?(p.value=s.data.content,z.value=s.data.totalElements,p.value.forEach(e=>{e.authorAvatar&&!e.authorAvatar.startsWith("http")&&(e.authorAvatar=`http://localhost:8080${e.authorAvatar}`)}),await me()):(p.value=[],z.value=0)}catch(s){console.error("获取博客列表失败:",s),p.value=[],z.value=0}finally{H.value=!1}},me=async()=>{try{const s=p.value.map(async e=>{try{const v=await b.get(`/api/comments/blog/${e.id}/count`);e.commentCount=v.data.count||0}catch(v){console.error(`获取博客 ${e.id} 评论数量失败:`,v),e.commentCount=0}});await Promise.all(s)}catch(s){console.error("获取评论数量失败:",s)}},le=()=>{U.value=!0,he(),ge()},_e=()=>{U.value=!1},K=()=>{const s={};f.value.trim()&&(s.keyword=f.value.trim()),A.value&&(s.category=A.value),R.value&&(s.tag=R.value),x.value&&(s.sort=x.value),U.value=!1,w.push({path:"/articles",query:s})},pe=()=>{f.value="",A.value="",R.value="",x.value="publishTime"},fe=s=>{f.value=s},he=async()=>{try{const s=await b.get("/api/categories");s.data&&Array.isArray(s.data)?$.value=s.data:$.value=[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"学习笔记"},{id:4,name:"项目经验"}]}catch(s){console.error("获取分类失败:",s);try{const e=await b.get("/api/blogs/categories");e.data&&($.value=e.data.map(v=>typeof v=="string"?{name:v}:v))}catch(e){console.error("获取分类失败（备选接口）:",e),$.value=[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"学习笔记"},{id:4,name:"项目经验"}]}}},ge=async()=>{try{const s=await b.get("/api/tags/active");s.data&&(q.value=s.data)}catch(s){console.error("获取标签失败:",s),q.value=[{id:1,name:"Vue.js",isActive:!0},{id:2,name:"Spring Boot",isActive:!0},{id:3,name:"JavaScript",isActive:!0},{id:4,name:"Java",isActive:!0},{id:5,name:"MySQL",isActive:!0},{id:6,name:"前端开发",isActive:!0},{id:7,name:"后端开发",isActive:!0}]}},oe=s=>{console.log("首页点击文章，ID:",s),w.push(`/blog/${s}`)},G=()=>{localStorage.getItem("userRole")==="admin"?w.push("/admin"):w.push("/dashboard")},ye=async()=>{Q.value=!0;try{try{const s=await b.get("/api/blogs/stats");s.data&&(h.value.totalBlogs=s.data.totalPublishedBlogs||0)}catch(s){console.warn("获取博客统计失败:",s),h.value.totalBlogs=p.value.length||0}try{const s=await b.get("/api/comments/stats");s.data&&(h.value.totalComments=s.data.totalApprovedComments||0)}catch(s){console.warn("获取评论统计失败:",s),h.value.totalComments=0}try{const s=await b.get("/api/users");s.data&&(h.value.totalUsers=Array.isArray(s.data)?s.data.length:0)}catch(s){console.warn("获取用户统计失败:",s),h.value.totalUsers=0}W.value=!0}catch(s){console.error("加载统计数据失败:",s),h.value={totalBlogs:p.value.length||0,totalComments:0,totalUsers:0},W.value=!0}finally{Q.value=!1}},ke=async()=>{const s=localStorage.getItem("userToken"),e=localStorage.getItem("adminToken"),v=s||e,g=localStorage.getItem("username"),D=localStorage.getItem("userRole");let c=!1;if(v)if(v.startsWith("token_")){const y=v.split("_");if(y.length>=3){const M=parseInt(y[2]),j=Date.now(),X=24*60*60*1e3;j-M<=X?c=!0:(localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),localStorage.removeItem("username"),localStorage.removeItem("userRole"))}}else c=!0;c?(C.value=!0,B.value=g||"用户",S.value=D||"user",await Se()):(C.value=!1,B.value="",S.value="",J.value="")},ne=()=>{localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),C.value=!1,B.value="",S.value="",location.reload()},be=s=>s?new Date(s).toLocaleDateString("zh-CN"):"",Ce=s=>{I.value=s,T.value=1,F()},we=s=>{T.value=s,F()},Se=async()=>{try{const s=localStorage.getItem("userToken")||localStorage.getItem("adminToken");if(!s){console.log("没有找到用户token");return}console.log("正在获取用户头像，token:",s);const e=await b.get("http://localhost:8080/api/auth/profile",{headers:{Authorization:`Bearer ${s}`}});if(console.log("API响应:",e.data),e.data&&e.data.avatar_url){const v=e.data.avatar_url.startsWith("http")?e.data.avatar_url:`http://localhost:8080${e.data.avatar_url}`;J.value=v,console.log("设置用户头像:",v)}else console.log("API响应中没有头像信息")}catch(s){console.error("获取用户头像失败:",s)}},O=()=>{w.push("/dashboard")},Ve=()=>{w.push("/login")},Ae=()=>{w.push("/register")};return Ue(async()=>{await ke(),F()}),(s,e)=>{const v=_("el-input"),g=_("el-button"),D=_("el-avatar"),c=_("el-icon"),y=_("el-dropdown-item"),M=_("el-dropdown-menu"),j=_("el-dropdown"),X=_("el-skeleton"),Te=_("el-empty"),Ie=_("el-pagination"),L=_("el-option"),Y=_("el-select"),ze=_("el-tag"),Be=_("el-dialog");return i(),u("div",Ee,[t("header",Je,[t("div",Ke,[e[18]||(e[18]=t("div",{class:"logo"},[t("h1",null,"📝 个人博客系统")],-1)),t("div",Me,[t("div",je,[a(v,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),placeholder:"搜索文章...",class:"search-input",onKeyup:ie(K,["enter"]),clearable:""},null,8,["modelValue"]),a(g,{type:"primary",class:"search-button",onClick:K,icon:n(E)},{default:o(()=>e[9]||(e[9]=[d(" 搜索 ")])),_:1,__:[9]},8,["icon"])])]),t("div",He,[C.value?(i(),k(j,{key:0,trigger:"hover",placement:"bottom-end"},{dropdown:o(()=>[a(M,null,{default:o(()=>[S.value==="admin"?(i(),k(y,{key:0,onClick:G},{default:o(()=>[a(c,null,{default:o(()=>[a(n(te))]),_:1}),e[10]||(e[10]=d(" 管理后台 "))]),_:1,__:[10]})):(i(),k(y,{key:1,onClick:O},{default:o(()=>[a(c,null,{default:o(()=>[a(n(ae))]),_:1}),e[11]||(e[11]=d(" 个人中心 "))]),_:1,__:[11]})),a(y,{divided:"",onClick:ne},{default:o(()=>[a(c,null,{default:o(()=>[a(n(ce))]),_:1}),e[12]||(e[12]=d(" 退出 "))]),_:1,__:[12]})]),_:1})]),default:o(()=>[t("div",We,[a(D,{size:32,src:J.value,icon:n(ee),class:"user-avatar"},null,8,["src","icon"]),t("span",Qe,m(B.value),1)])]),_:1})):(i(),u("div",qe,[a(g,{onClick:Ve,size:"small"},{default:o(()=>e[13]||(e[13]=[d("登录")])),_:1,__:[13]}),a(g,{type:"primary",onClick:Ae,size:"small"},{default:o(()=>e[14]||(e[14]=[d("注册")])),_:1,__:[14]})]))]),t("nav",Fe,[t("div",Ge,[t("div",Oe,[C.value?(i(),k(j,{key:0,trigger:"hover",placement:"bottom-end"},{dropdown:o(()=>[a(M,null,{default:o(()=>[S.value==="admin"?(i(),k(y,{key:0,onClick:G},{default:o(()=>[a(c,null,{default:o(()=>[a(n(te))]),_:1}),e[15]||(e[15]=d(" 管理后台 "))]),_:1,__:[15]})):(i(),k(y,{key:1,onClick:O},{default:o(()=>[a(c,null,{default:o(()=>[a(n(ae))]),_:1}),e[16]||(e[16]=d(" 个人中心 "))]),_:1,__:[16]})),a(y,{divided:"",onClick:ne},{default:o(()=>[a(c,null,{default:o(()=>[a(n(ce))]),_:1}),e[17]||(e[17]=d(" 退出 "))]),_:1,__:[17]})]),_:1})]),default:o(()=>[t("div",Xe,[a(D,{size:32,src:J.value,icon:n(ee),class:"user-avatar"},null,8,["src","icon"]),t("span",Ye,m(B.value),1)])]),_:1})):V("",!0)])])])])]),t("main",Ze,[t("div",et,[t("aside",tt,[t("div",at,[t("div",st,[e[24]||(e[24]=t("h3",{class:"sidebar-title"},"导航菜单",-1)),t("ul",lt,[t("li",ot,[a(c,null,{default:o(()=>[a(n($e))]),_:1}),e[19]||(e[19]=t("span",null,"首页",-1))]),t("li",{class:"menu-item",onClick:e[1]||(e[1]=l=>s.$router.push("/articles"))},[a(c,null,{default:o(()=>[a(n(De))]),_:1}),e[20]||(e[20]=t("span",null,"文章",-1))]),t("li",{class:"menu-item",onClick:le},[a(c,null,{default:o(()=>[a(n(E))]),_:1}),e[21]||(e[21]=t("span",null,"搜索",-1))]),C.value&&S.value==="admin"?(i(),u("li",{key:0,class:"menu-item",onClick:G},[a(c,null,{default:o(()=>[a(n(te))]),_:1}),e[22]||(e[22]=t("span",null,"管理后台",-1))])):V("",!0),C.value&&S.value!=="admin"?(i(),u("li",{key:1,class:"menu-item",onClick:O},[a(c,null,{default:o(()=>[a(n(ae))]),_:1}),e[23]||(e[23]=t("span",null,"个人中心",-1))])):V("",!0)])])])]),t("div",nt,[t("section",it,[t("div",ct,[e[26]||(e[26]=t("h1",null,"📝 个人博客系统",-1)),e[27]||(e[27]=t("p",null,"一个功能完整的Spring Boot博客系统，支持文章管理、用户系统、评论功能等",-1)),C.value?(i(),u("div",rt,[a(g,{type:"primary",onClick:ye,loading:Q.value,size:"small"},{default:o(()=>e[25]||(e[25]=[d("查看系统统计")])),_:1,__:[25]},8,["loading"])])):V("",!0)])]),W.value?(i(),u("section",dt,[t("div",ut,[t("div",vt,[t("div",mt,m(h.value.totalBlogs),1),e[28]||(e[28]=t("div",{class:"stat-label"},"已发布文章",-1))]),t("div",_t,[t("div",pt,m(h.value.totalComments),1),e[29]||(e[29]=t("div",{class:"stat-label"},"评论总数",-1))]),t("div",ft,[t("div",ht,m(h.value.totalUsers),1),e[30]||(e[30]=t("div",{class:"stat-label"},"注册用户",-1))])])])):V("",!0),t("div",gt,[t("div",yt,[e[32]||(e[32]=t("h2",{class:"section-title"},"最新文章",-1)),a(g,{type:"primary",onClick:le,icon:n(E),size:"small"},{default:o(()=>e[31]||(e[31]=[d(" 搜索文章 ")])),_:1,__:[31]},8,["icon"])]),H.value?(i(),u("div",kt,[a(X,{rows:3,animated:""})])):p.value.length===0?(i(),u("div",bt,[a(Te,{description:"暂无文章"})])):(i(),u("div",Ct,[(i(!0),u(N,null,P(p.value,l=>(i(),u("div",{key:l.id,class:"blog-card",onClick:Z=>oe(l.id)},[t("div",St,[t("h3",Vt,m(l.title),1),t("p",At,m(l.summary||l.content.substring(0,120)+"..."),1),t("div",Tt,[t("span",It,[a(D,{size:18,src:l.authorAvatar,icon:n(ee),class:"author-avatar"},null,8,["src","icon"]),d(" "+m(l.authorName||l.author),1)]),t("span",zt,[a(c,null,{default:o(()=>[a(n(re))]),_:1}),d(" "+m(be(l.publishedAt||l.createdAt)),1)]),t("span",Bt,[a(c,null,{default:o(()=>[a(n(de))]),_:1}),d(" "+m(l.viewCount||l.views||0),1)])])])],8,wt))),128))])),z.value>I.value?(i(),u("div",Ut,[a(Ie,{"current-page":T.value,"onUpdate:currentPage":e[2]||(e[2]=l=>T.value=l),"page-size":I.value,"onUpdate:pageSize":e[3]||(e[3]=l=>I.value=l),total:z.value,"page-sizes":[10,20,50],layout:"prev, pager, next",onSizeChange:Ce,onCurrentChange:we,small:""},null,8,["current-page","page-size","total"])])):V("",!0)])]),t("aside",Rt,[t("div",xt,[t("div",$t,[e[33]||(e[33]=t("h3",{class:"sidebar-title"},"热门文章",-1)),t("div",Dt,[(i(!0),u(N,null,P(p.value.slice(0,5),(l,Z)=>(i(),u("div",{key:"hot-"+l.id,class:"hot-article-item",onClick:ia=>oe(l.id)},[t("span",Nt,m(Z+1),1),t("div",Pt,[t("h4",Et,m(l.title),1),t("div",Jt,[t("span",Kt,m(l.viewCount||0)+" 阅读",1)])])],8,Lt))),128))])]),e[34]||(e[34]=Re('<div class="sidebar-section" data-v-16cc573c><h3 class="sidebar-title" data-v-16cc573c>功能特色</h3><div class="feature-list" data-v-16cc573c><div class="feature-item" data-v-16cc573c><div class="feature-icon" data-v-16cc573c>📚</div><div class="feature-text" data-v-16cc573c><h4 data-v-16cc573c>文章管理</h4><p data-v-16cc573c>完整的内容管理功能</p></div></div><div class="feature-item" data-v-16cc573c><div class="feature-icon" data-v-16cc573c>👥</div><div class="feature-text" data-v-16cc573c><h4 data-v-16cc573c>用户系统</h4><p data-v-16cc573c>权限管理和用户认证</p></div></div><div class="feature-item" data-v-16cc573c><div class="feature-icon" data-v-16cc573c>💬</div><div class="feature-text" data-v-16cc573c><h4 data-v-16cc573c>评论功能</h4><p data-v-16cc573c>互动评论和回复</p></div></div><div class="feature-item" data-v-16cc573c><div class="feature-icon" data-v-16cc573c>🔍</div><div class="feature-text" data-v-16cc573c><h4 data-v-16cc573c>搜索功能</h4><p data-v-16cc573c>快速查找内容</p></div></div></div></div><div class="sidebar-section" data-v-16cc573c><h3 class="sidebar-title" data-v-16cc573c>系统信息</h3><div class="system-info" data-v-16cc573c><div class="info-item" data-v-16cc573c><span class="info-label" data-v-16cc573c>技术栈</span><span class="info-value" data-v-16cc573c>Spring Boot + Vue 3</span></div><div class="info-item" data-v-16cc573c><span class="info-label" data-v-16cc573c>版本</span><span class="info-value" data-v-16cc573c>v1.0.0</span></div><div class="info-item" data-v-16cc573c><span class="info-label" data-v-16cc573c>更新时间</span><span class="info-value" data-v-16cc573c>2025-01-01</span></div></div></div>',2))])])])]),e[44]||(e[44]=t("footer",{class:"footer"},[t("div",{class:"container"},[t("p",null,"© 2025 个人博客系统. 基于 Spring Boot 开发.")])],-1)),a(Be,{modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=l=>U.value=l),title:"搜索文章",width:"600px","before-close":_e,class:"search-dialog"},{footer:o(()=>[t("div",la,[a(g,{onClick:pe,icon:n(Ne)},{default:o(()=>e[42]||(e[42]=[d("清除")])),_:1,__:[42]},8,["icon"]),a(g,{type:"primary",onClick:K,icon:n(E)},{default:o(()=>e[43]||(e[43]=[d(" 搜索 ")])),_:1,__:[43]},8,["icon"])])]),default:o(()=>[t("div",Mt,[t("div",jt,[a(v,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),placeholder:"请输入关键词搜索文章...",size:"large",class:"search-input",onKeyup:ie(K,["enter"]),clearable:"",autofocus:""},{prefix:o(()=>[a(c,{class:"search-icon"},{default:o(()=>[a(n(E))]),_:1})]),_:1},8,["modelValue"])]),t("div",Ht,[t("div",Wt,[t("label",Qt,[a(c,null,{default:o(()=>[a(n(ue))]),_:1}),e[35]||(e[35]=d(" 分类筛选 "))]),a(Y,{modelValue:A.value,"onUpdate:modelValue":e[5]||(e[5]=l=>A.value=l),placeholder:"选择分类",clearable:"",class:"category-select"},{default:o(()=>[(i(!0),u(N,null,P($.value,l=>(i(),k(L,{key:l.id||l,label:l.name||l,value:l.name||l},{default:o(()=>[t("div",qt,[a(c,null,{default:o(()=>[a(n(ue))]),_:1}),t("span",null,m(l.name||l),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",Ft,[t("label",Gt,[a(c,null,{default:o(()=>[a(n(se))]),_:1}),e[36]||(e[36]=d(" 标签筛选 "))]),a(Y,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=l=>R.value=l),placeholder:"选择标签",clearable:"",class:"tag-select"},{default:o(()=>[(i(!0),u(N,null,P(q.value,l=>(i(),k(L,{key:l.id||l,label:l.name||l,value:l.name||l},{default:o(()=>[t("div",Ot,[a(c,null,{default:o(()=>[a(n(se))]),_:1}),t("span",null,m(l.name||l),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",Xt,[t("label",Yt,[a(c,null,{default:o(()=>[a(n(de))]),_:1}),e[37]||(e[37]=d(" 排序方式 "))]),a(Y,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=l=>x.value=l),placeholder:"选择排序",class:"sort-select"},{default:o(()=>[a(L,{label:"发布时间",value:"publishTime"},{default:o(()=>[t("div",Zt,[a(c,null,{default:o(()=>[a(n(re))]),_:1}),e[38]||(e[38]=t("span",null,"发布时间",-1))])]),_:1}),a(L,{label:"最受欢迎",value:"popularity"},{default:o(()=>[t("div",ea,[a(c,null,{default:o(()=>[a(n(se))]),_:1}),e[39]||(e[39]=t("span",null,"最受欢迎",-1))])]),_:1}),a(L,{label:"浏览最多",value:"views"},{default:o(()=>[t("div",ta,[a(c,null,{default:o(()=>[a(n(Le))]),_:1}),e[40]||(e[40]=t("span",null,"浏览最多",-1))])]),_:1})]),_:1},8,["modelValue"])])]),!f.value&&!A.value?(i(),u("div",aa,[e[41]||(e[41]=t("h4",null,"热门搜索",-1)),t("div",sa,[(i(!0),u(N,null,P(ve.value,l=>(i(),k(ze,{key:l,onClick:Z=>fe(l),class:"suggestion-tag",effect:"plain"},{default:o(()=>[d(m(l),1)]),_:2},1032,["onClick"]))),128))])])):V("",!0)])]),_:1},8,["modelValue"])])}}},va=Pe(oa,[["__scopeId","data-v-16cc573c"]]);export{va as default};
